# Redis Cluster for testing
# Usage: docker-compose -f docker/docker-compose.cluster.yml up -d
#
# Cluster will be available at localhost:17000-17005 (mapped from internal 7000-7005)
# Set REDIS_CLUSTER_URL=redis://localhost:17000,redis://localhost:17001,redis://localhost:17002
#
# Note: Uses port mapping for macOS compatibility (network_mode: host doesn't work on macOS)
# External ports 17000-17005 are used to avoid conflicts with other services on ports 7000-7005

services:
  redis-cluster:
    image: redislabs/client-libs-test:8.4.0
    container_name: redis-cluster
    environment:
      - REDIS_CLUSTER=yes
      - NODES=6
      - REPLICAS=1
      - PORT=17000
    command: --enable-debug-command yes --save ""
    ports:
      - "17000-17005:17000-17005"
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "7000", "cluster", "info"]
      interval: 5s
      timeout: 10s
      retries: 30
      start_period: 30s
