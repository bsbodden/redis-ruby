# Redis Cluster for testing
# Usage: docker-compose -f docker/docker-compose.cluster.yml up -d
#
# Cluster will be available at localhost:7000-7005
# Set REDIS_CLUSTER_URL=redis://localhost:7000,redis://localhost:7001,redis://localhost:7002
#
# Note: Uses host networking so cluster nodes announce accessible IPs
# This avoids the issue where nodes announce 127.0.0.1 which is unreachable
# from other containers.

services:
  redis-cluster:
    image: grokzen/redis-cluster:7.0.10
    platform: linux/amd64
    network_mode: host
    environment:
      - IP=0.0.0.0
      - INITIAL_PORT=7000
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "7000", "cluster", "info"]
      interval: 5s
      timeout: 10s
      retries: 30
      start_period: 30s
